<?php require('templates/header.phtml') ?>

<?php
if (isset($_POST['search'])) {
    $query = "SELECT * FROM delivery_point WHERE id LIKE '%" . $_POST['idSearch'] . "%'
    AND name LIKE '%" . $_POST['nameSearch'] . "%'
    AND address LIKE '%" . $_POST['addressSearch'] . "%'
    AND city LIKE '%" . $_POST['citySearch'] . "%'
    AND postcode LIKE '%" . $_POST['postSearch'] . "%'
    AND latitude LIKE '%" . $_POST['latSearch'] . "%'
    AND longitude LIKE '%" . $_POST['longSearch'] . "%'";

    $search_result = filterTable($query);

} elseif (isset($_POST['clear'])){
    $query = "SELECT * FROM delivery_point";
    $search_result = filterTable($query);
} else {
    $query = "SELECT * FROM delivery_point";
    $search_result = filterTable($query);
}
function filterTable($query)
{
    $connect = mysqli_connect("poseidon.salford.ac.uk", "aee805", "Polyjuice23!", "aee805");
    $filter_Result = mysqli_query($connect, $query);
    return $filter_Result;
}

?>
    <!-- Form for filtering through HTML table in Deliverer Page -->
    <form action="<?php echo $_SERVER['PHP_SELF']; ?>" method="post">
        <label class="h4">Filter Table:</label><br>
<!--        <label for="id">ID:</label>-->
        <input type="text" id="id" name="idSearch" placeholder="ID" class="form-control">
<!--        <label for="name">Name:</label>-->
        <input type="text" id="name" name="nameSearch" placeholder="Name" class="form-control">
<!--        <label for="address">Address:</label>-->
        <input type="text" id="address" name="addressSearch" placeholder="Address" class="form-control">
<!--        <label for="city">City:</label>-->
        <input type="text" id="city" name="citySearch" placeholder="City" class="form-control">
<!--        <label for="postcode">Postcode:</label>-->
        <input type="text" id="postcode" name="postSearch" placeholder="Postcode" class="form-control">
<!--        <label for="lat">Latitude:</label>-->
        <input type="text" id="lat" name="latSearch" placeholder="Latitude" class="form-control">
<!--        <label for="long">Longitude:</label>-->
        <input type="text" id="long" name="longSearch" placeholder="Longitude" class="form-control"><br>
        <input type="submit" name="search" value="Filter" class="form-control">
        <input type="submit" name="clear" value="Clear Filter" class="form-control">
    </form>

    <!-- Form to display the deliverers deliveries in HTML table -->
    <form action=" <?php echo $_SERVER['PHP_SELF']; ?>" method="post">
    <br>
    <table class="table table-hover">
        <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Address</th>
            <th>City</th>
            <th>Postcode</th>
            <th>Lat</th>
            <th>Long</th>
        </tr>


        </thead>
        <tbody>
<!--        --><?php //foreach ($view->deliveryPointsSet as $deliveryPoint) {
//            echo '<tr> <td>' . $deliveryPoint->getID() .
//                '</td> <td>' . $deliveryPoint->getName() .
//                '</td> <td>' . $deliveryPoint->getAddress() .
//                '</td> <td>' . $deliveryPoint->getCity() .
//                '</td> <td>' . $deliveryPoint->getPostcode() .
//                '</td> <td>' . $deliveryPoint->getLat() .
//                '</td> <td>' . $deliveryPoint->getLong();
//        } ?>

        <?php while ($row = mysqli_fetch_array($search_result)): ?>
        <tr>
            <td><?php echo $row['id'];?></td>
            <td><?php echo $row['name'];?></td>
            <td><?php echo $row['address'];?></td>
            <td><?php echo $row['city'];?></td>
            <td><?php echo $row['postcode'];?></td>
            <td><?php echo $row['latitude'];?></td>
            <td><?php echo $row['longitude'];?></td>
        </tr>
<?php endwhile;?>
        </tbody>
    </table>
    </form>

    <?php require('templates/footer.phtml') ?>